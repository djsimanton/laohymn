const CACHE_NAME = 'hmonghymn-cache-v20';
const urlsToCache = [
  '/',    // Root index.html
  '/manifest.json',
  '/icon-192.png',
  '/icon-512.png',

'contentalpha.html',
'contentenglish.html',
'contentnumeric.html',
'contents.html',
'h.html',
'h1.html',
'h10.html',
'h100.html',
'h101.html',
'h102.html',
'h103.html',
'h104.html',
'h105.html',
'h106.html',
'h107.html',
'h108.html',
'h109.html',
'h11.html',
'h110.html',
'h111.html',
'h112.html',
'h113.html',
'h114.html',
'h115.html',
'h116.html',
'h117.html',
'h118.html',
'h119.html',
'h12.html',
'h120.html',
'h121.html',
'h122.html',
'h123.html',
'h124.html',
'h125.html',
'h126.html',
'h127.html',
'h128.html',
'h129.html',
'h13.html',
'h130.html',
'h131.html',
'h132.html',
'h133.html',
'h134.html',
'h135.html',
'h136.html',
'h137.html',
'h138.html',
'h139.html',
'h14.html',
'h140.html',
'h141.html',
'h142.html',
'h143.html',
'h144.html',
'h145.html',
'h146.html',
'h147.html',
'h148.html',
'h149.html',
'h15.html',
'h150.html',
'h151.html',
'h152.html',
'h153.html',
'h154.html',
'h155.html',
'h156.html',
'h157.html',
'h158.html',
'h159.html',
'h16.html',
'h160.html',
'h161.html',
'h162.html',
'h163.html',
'h164.html',
'h165.html',
'h166.html',
'h167.html',
'h168.html',
'h169.html',
'h17.html',
'h170.html',
'h171.html',
'h172.html',
'h173.html',
'h174.html',
'h175.html',
'h176.html',
'h177.html',
'h178.html',
'h179.html',
'h18.html',
'h180.html',
'h181.html',
'h182.html',
'h183.html',
'h184.html',
'h185.html',
'h186.html',
'h187.html',
'h188.html',
'h189.html',
'h19.html',
'h190.html',
'h191.html',
'h192.html',
'h193.html',
'h194.html',
'h195.html',
'h196.html',
'h197.html',
'h198.html',
'h199.html',
'h2.html',
'h20.html',
'h200.html',
'h201.html',
'h202.html',
'h203.html',
'h204.html',
'h205.html',
'h206.html',
'h207.html',
'h208.html',
'h209.html',
'h21.html',
'h210.html',
'h211.html',
'h212.html',
'h213.html',
'h214.html',
'h215.html',
'h216.html',
'h217.html',
'h218.html',
'h219.html',
'h22.html',
'h220.html',
'h221.html',
'h222.html',
'h223.html',
'h224.html',
'h225.html',
'h226.html',
'h227.html',
'h228.html',
'h229.html',
'h23.html',
'h230.html',
'h231.html',
'h232.html',
'h233.html',
'h234.html',
'h235.html',
'h236.html',
'h237.html',
'h238.html',
'h239.html',
'h24.html',
'h240.html',
'h241.html',
'h242.html',
'h243.html',
'h244.html',
'h245.html',
'h246.html',
'h247.html',
'h248.html',
'h249.html',
'h25.html',
'h250.html',
'h251.html',
'h252.html',
'h253.html',
'h254.html',
'h255.html',
'h256.html',
'h257.html',
'h258.html',
'h259.html',
'h26.html',
'h260.html',
'h261.html',
'h262.html',
'h263.html',
'h264.html',
'h265.html',
'h266.html',
'h267.html',
'h268.html',
'h269.html',
'h27.html',
'h270.html',
'h271.html',
'h272.html',
'h273.html',
'h274.html',
'h275.html',
'h276.html',
'h277.html',
'h278.html',
'h279.html',
'h28.html',
'h280.html',
'h281.html',
'h282.html',
'h283.html',
'h284.html',
'h285.html',
'h286.html',
'h287.html',
'h288.html',
'h289.html',
'h29.html',
'h3.html',
'h30.html',
'h31.html',
'h32.html',
'h33.html',
'h34.html',
'h35.html',
'h36.html',
'h37.html',
'h38.html',
'h39.html',
'h4.html',
'h40.html',
'h41.html',
'h42.html',
'h43.html',
'h44.html',
'h45.html',
'h46.html',
'h47.html',
'h48.html',
'h49.html',
'h5.html',
'h50.html',
'h51.html',
'h52.html',
'h53.html',
'h54.html',
'h55.html',
'h56.html',
'h57.html',
'h58.html',
'h59.html',
'h6.html',
'h60.html',
'h61.html',
'h62.html',
'h63.html',
'h64.html',
'h65.html',
'h66.html',
'h67.html',
'h68.html',
'h69.html',
'h7.html',
'h70.html',
'h71.html',
'h72.html',
'h73.html',
'h74.html',
'h75.html',
'h76.html',
'h77.html',
'h78.html',
'h79.html',
'h8.html',
'h80.html',
'h81.html',
'h82.html',
'h83.html',
'h84.html',
'h85.html',
'h86.html',
'h87.html',
'h88.html',
'h89.html',
'h9.html',
'h90.html',
'h91.html',
'h92.html',
'h93.html',
'h94.html',
'h95.html',
'h96.html',
'h97.html',
'h98.html',
'h99.html',
'index.html',
'license.html',
'css/index.css',
'css/slider.css',
'css/style.css',
'fonts/fonts.css',
'fonts/Phetsarath-Bold.ttf',
'fonts/Phetsarath-Regular.ttf',
'images/appname.png',
'images/arrow-l-black.png',
'images/arrow-r-black.png',
'images/booktitle.png',
'images/booktitle_old1.png',
'images/booktitle_old2.png',
'images/call.png',
'images/CC.png',
'images/footer_bg.png',
'images/footer_bg1.png',
'images/logo.png',
'images/logo.psd',
'images/music-notes.jpg',
'images/pin.png',
'images/search.png',
'images/search_h.png',
'images/slide-pagenat.png',
'images/slider-icons.png',
'images/slider_bg.jpg',
'images/slider_bg1.jpg',
'images/top-move.jpg',
'js/easing.js',
'js/index.js',
'js/jquery.cslider.js',
'js/jquery.flexisel.js',
'js/jquery.min.js',
'js/modernizr.custom.28468.js',
'js/move-top.js',
'js/script.js',
'js/font-buttons.js'


  // Add more files as needed
];

// Install event: cache essential files
self.addEventListener('install', event => {
  event.waitUntil(
    caches.open(CACHE_NAME).then(cache => {
      return cache.addAll(urlsToCache);
    })
  );
});

// Activate event: cleanup old caches if needed
self.addEventListener('activate', event => {
  event.waitUntil(
    caches.keys().then(cacheNames =>
      Promise.all(
        cacheNames.map(cache => {
          if (cache !== CACHE_NAME) {
            return caches.delete(cache);
          }
        })
      )
    )
  );
});

// Fetch event: serve from cache, then fallback
self.addEventListener('fetch', event => {
  const request = event.request;
  const url = new URL(request.url);

  // Handle HTML navigation requests with .html fallback
  if (
    request.mode === 'navigate' ||
    (request.headers.get('accept')?.includes('text/html') && !url.pathname.endsWith('.html'))
  ) {
    const fallbackUrl = url.pathname.endsWith('/')
      ? `${url.pathname}index.html`
      : `${url.pathname}.html`;

    event.respondWith(
      caches.match(fallbackUrl).then(response => {
        return response || caches.match('/contents.html');
      })
    );
    return;
  }

  // Normal asset fetch
  event.respondWith(
    caches.match(request).then(response => {
      return (
        response ||
        fetch(request).catch(() => {
          // Fallback to contents.html if it's a navigation request
          if (request.mode === 'navigate') {
            return caches.match('/contents.html');
          }
        })
      );
    })
  );
});